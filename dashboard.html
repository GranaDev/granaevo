<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - GranaEvo</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="graficos.css">
    <link rel="stylesheet" href="chat-assistant.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script type="module" src="supabase-client.js"></script>
    <script type="module" src="data-manager.js"></script>
    <script type="module" src="auth-guard.js"></script>
    
    <style>
        /* Loading de autentica√ß√£o */
        .auth-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0f1a;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            flex-direction: column;
        }
        
        .auth-loading .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(16, 185, 129, 0.3);
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .auth-loading p {
            color: #10b981;
            margin-top: 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- LOADING DE AUTENTICA√á√ÉO -->
    <div class="auth-loading" id="authLoading">
        <div class="spinner"></div>
        <p>üîí Verificando acesso...</p>
    </div>

    <!-- CONTE√öDO PROTEGIDO -->
    <div data-protected-content style="display: none;">
        
        <!-- ========== SELE√á√ÉO DE PERFIS ========== -->
        <div id="selecaoPerfis" class="perfis-screen">
            <div class="perfis-container">
                <h1 id="saudacaoPerfis" class="perfis-title">Selecione seu Perfil</h1>
                <div id="listaPerfis" class="perfis-grid"></div>
            </div>
        </div>

        <!-- ========== BOT√ÉO MOBILE (FORA DA SIDEBAR) ========== -->
        <button class="sidebar-toggle" id="sidebarToggle">
            <span class="hamburger"></span>
        </button>

        <!-- ========== SIDEBAR ========== -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
            <div class="logo">
                <div class="logo-img-wrapper">
                    <img src="icon/granaevo-logo.jpg" alt="GranaEvo" class="logo-img">
                </div>
                <span class="logo-text">GranaEvo</span>
            </div>
        </div>

            <div class="sidebar-user">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Ccircle cx='40' cy='40' r='40' fill='%2310b981'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='32' fill='white'%3EU%3C/text%3E%3C/svg%3E" 
                     alt="Foto" 
                     id="userPhoto" 
                     class="user-photo">
                <div class="user-info">
                    <div class="user-name" id="userName">Usu√°rio</div>
                    <div class="user-plan" data-user-plan>Plano Premium</div>
                </div>
                <label for="photoUpload" class="photo-upload-btn"><i class="fas fa-camera"></i></label>
                <input type="file" id="photoUpload" accept="image/*" style="display:none;">
            </div>

            <nav class="sidebar-nav">
                <button class="nav-btn active" data-page="dashboard">
                    <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                    <span class="nav-text">Dashboard</span>
                </button>
                <button class="nav-btn" data-page="transacoes">
                    <span class="nav-icon"><i class="fas fa-credit-card"></i></span>
                    <span class="nav-text">Transa√ß√µes</span>
                </button>
                <button class="nav-btn" data-page="reservas">
                    <span class="nav-icon"><i class="fas fa-bullseye"></i></span>
                    <span class="nav-text">Reservas</span>
                </button>
                <button class="nav-btn" data-page="cartoes">
                    <span class="nav-icon"><i class="fas fa-gem"></i></span>
                    <span class="nav-text">Cart√µes</span>
                </button>
                <button class="nav-btn" data-page="graficos">
                    <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                    <span class="nav-text">Gr√°ficos</span>
                </button>
                <button class="nav-btn" data-page="relatorios">
                    <span class="nav-icon"><i class="fas fa-file-alt"></i></span>
                    <span class="nav-text">Relat√≥rios</span>
                </button>
                <button class="nav-btn" data-page="configuracoes">
                    <span class="nav-icon"><i class="fas fa-cog"></i></span>
                    <span class="nav-text">Configura√ß√µes</span>
                </button>
            </nav>
        </aside>

        <!-- ========== MAIN CONTENT ========== -->
        <main class="main-content" id="mainContent">
            
            <!-- DASHBOARD -->
            <section class="page active" id="dashboardPage">
                <div class="page-header-premium">
                    <div class="header-content">
                        <div class="header-title-group">
                            <div class="breadcrumb-premium">
                                <a href="dashboard.html">In√≠cio</a>
                                <span class="separator">‚Ä∫</span>
                                <span>Dashboard</span>
                            </div>
                            <h1 class="page-title-premium"><i class="fas fa-chart-line"></i> Dashboard</h1>
                            <p class="page-subtitle-premium">Vis√£o geral completa das suas finan√ßas</p>
                        </div>
                        <div class="header-actions">
                        </div>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="card card-green">
                        <div class="card-icon"><i class="fas fa-arrow-up"></i></div>
                        <div class="card-content">
                            <div class="card-label">Entradas</div>
                            <div class="card-value" id="totalEntradas">R$ 0,00</div>
                        </div>
                    </div>

                    <div class="card card-red">
                        <div class="card-icon"><i class="fas fa-arrow-down"></i></div>
                        <div class="card-content">
                            <div class="card-label">Sa√≠das</div>
                            <div class="card-value" id="totalSaidas">R$ 0,00</div>
                        </div>
                    </div>

                    <div class="card card-blue">
                        <div class="card-icon"><i class="fas fa-wallet"></i></div>
                        <div class="card-content">
                            <div class="card-label">Saldo</div>
                            <div class="card-value" id="totalSaldo">R$ 0,00</div>
                        </div>
                    </div>

                    <div class="card card-yellow">
                        <div class="card-icon"><i class="fas fa-piggy-bank"></i></div>
                        <div class="card-content">
                            <div class="card-label">Reservas</div>
                            <div class="card-value" id="totalReservas">R$ 0,00</div>
                        </div>
                    </div>
                </div>

                <div class="section-box">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-file-invoice-dollar"></i> Contas Fixas</h2>
                        <button class="btn-primary" id="btnNovaContaFixa"><i class="fas fa-plus"></i> Nova Conta</button>
                    </div>
                    <div id="listaContasFixas" class="contas-grid">
                        <p class="empty-state">Nenhuma conta fixa cadastrada.</p>
                    </div>
                </div>

                <!-- ADICIONAR AP√ìS A SE√á√ÉO DE CONTAS FIXAS -->
            <div class="section-box" style="margin-top:32px; text-align:center; cursor:pointer; transition:all 0.3s;" 
                onclick="abrirWidgetOndeForDinheiro()"
                onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 24px rgba(67,160,71,0.3)';"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)';">
                <div style="font-size:3rem; margin-bottom:12px;">üí∏</div>
                <h3 style="margin-bottom:8px; color:var(--text-primary);">Onde Foi Meu Dinheiro?</h3>
                <p style="color:var(--text-secondary); font-size:0.9rem; margin-bottom:16px;">
                    Descubra para onde seus gastos est√£o indo com an√°lise inteligente
                </p>
                <button class="btn-primary" style="pointer-events:none;">
                    üîç Analisar Agora
                </button>
            </div>
            </section>

            <!-- TRANSA√á√ïES -->
            <section class="page" id="transacoesPage">
                <div class="page-header-premium">
                    <div class="header-content">
                        <div class="header-title-group">
                            <div class="breadcrumb-premium">
                                <a href="dashboard.html">In√≠cio</a>
                                <span class="separator">‚Ä∫</span>
                                <span>Transa√ß√µes</span>
                            </div>
                            <h1 class="page-title-premium"><i class="fas fa-credit-card"></i> Transa√ß√µes</h1>
                            <p class="page-subtitle-premium">Registre e gerencie todas as suas movimenta√ß√µes financeiras</p>
                        </div>
                        <div class="header-actions">
                        </div>
                    </div>
                </div>

                <div class="transaction-form">
                    <select id="selectCategoria" class="form-input">
                        <option value="">Selecione a categoria</option>
                        <option value="entrada"><i class="fas fa-arrow-up"></i> Entrada</option>
                        <option value="saida"><i class="fas fa-arrow-down"></i> Sa√≠da</option>
                        <option value="reserva"><i class="fas fa-bullseye"></i> Reserva</option>
                        <option value="saida_credito"><i class="fas fa-credit-card"></i> Sa√≠da no Cr√©dito</option>
                    </select>

                    <select id="selectTipo" class="form-input">
                        <option value="">Selecione o tipo</option>
                    </select>

                    <input type="text" id="inputDescricao" class="form-input" placeholder="Descri√ß√£o">
                    <input type="number" id="inputValor" class="form-input" placeholder="Valor (R$)" step="0.01" min="0">

                    <div id="creditoFields" style="display:none;">
                        <select id="selectCartao" class="form-input">
                            <option value="">Selecione o cart√£o</option>
                        </select>
                        <select id="selectParcelas" class="form-input">
                            <option value="1">1x</option>
                        </select>
                    </div>

                    <button class="btn-primary btn-large" id="btnLancar">Lan√ßar Transa√ß√£o</button>
                </div>

                <div class="section-box">
                    <h2 class="section-title"><i class="fas fa-list"></i> Movimenta√ß√µes</h2>
                    <div id="listaMovimentacoes" class="movimentacoes-list">
                        <p class="empty-state">Nenhuma movimenta√ß√£o registrada.</p>
                    </div>
                </div>
            </section>

            <!-- RESERVAS -->
            <section class="page" id="reservasPage">
                <div class="page-header-premium">
                    <div class="header-content">
                        <div class="header-title-group">
                            <div class="breadcrumb-premium">
                                <a href="dashboard.html">In√≠cio</a>
                                <span class="separator">‚Ä∫</span>
                                <span>Reservas</span>
                            </div>
                            <h1 class="page-title-premium"><i class="fas fa-bullseye"></i> Reservas</h1>
                            <p class="page-subtitle-premium">Organize e acompanhe suas reservas e objetivos financeiros</p>
                        </div>
                    </div>
                    <div class="header-stats">
                        <div class="header-stat-item">
                            <span class="header-stat-label">Total Reservado</span>
                            <span class="header-stat-value" id="headerTotalReservas">R$ 0,00</span>
                        </div>
                        <div class="header-stat-item">
                            <span class="header-stat-label">Reservas Ativas</span>
                            <span class="header-stat-value" id="headerQtdReservas">0</span>
                        </div>
                    </div>
                </div>

                <div class="reservas-layout">
                    <div class="reservas-sidebar">
                        <div class="section-header">
                            <h3>Lista de Reservas</h3>
                            <button class="btn-primary" id="btnNovaMeta"><i class="fas fa-plus"></i> Nova Reserva</button>
                        </div>
                        <div id="listaMetas" class="metas-list">
                            <p class="empty-state">Nenhuma reserva criada.</p>
                        </div>
                    </div>

                    <div class="reservas-main">
                        <div class="meta-visual">
                            <div class="charts-container">
                                <div class="chart-wrapper">
                                    <canvas id="donutChart" width="180" height="180"></canvas>
                                    <div id="metaProgress" class="meta-progress-text">Selecione uma reserva</div>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="lineChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                            <div id="metaDetalhes" class="meta-details"></div>
                            <button class="btn-warning" id="btnRetirar" style="display:none;">Retirar Dinheiro</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CART√ïES -->
            <section class="page" id="cartoesPage">
                <div class="page-header-premium">
                    <div class="header-content">
                        <div class="header-title-group">
                            <div class="breadcrumb-premium">
                                <a href="dashboard.html">In√≠cio</a>
                                <span class="separator">‚Ä∫</span>
                                <span>Cart√µes</span>
                            </div>
                            <h1 class="page-title-premium"><i class="fas fa-credit-card"></i> Cart√µes</h1>
                            <p class="page-subtitle-premium">Controle total dos seus cart√µes de cr√©dito e faturas</p>
                        </div>
                        <div class="header-actions">
                        </div>
                    </div>
                </div>
                <div id="cartoesGrid" class="cartoes-grid"></div>
            </section>

            <!-- GR√ÅFICOS PREMIUM -->
            <section class="page" id="graficosPage">
                <div class="page-header-premium">
                    <div class="header-content">
                        <div class="header-title-group">
                            <div class="breadcrumb-premium">
                                <a href="dashboard.html">In√≠cio</a>
                                <span class="separator">‚Ä∫</span>
                                <span>Gr√°ficos</span>
                            </div>
                            <h1 class="page-title-premium"><i class="fas fa-chart-pie"></i> An√°lise Financeira</h1>
                            <p class="page-subtitle-premium">Visualize seus dados de forma inteligente e profissional</p>
                        </div>
                    </div>
                </div>

                <!-- FILTROS DOS GR√ÅFICOS -->
                <div class="graficos-filtros">
                    <div class="view-type-btns">
                        <button class="view-btn active" data-tipo="individual">
                            <i class="fas fa-user"></i> Individual
                        </button>
                        <button class="view-btn" data-tipo="casal">
                            <i class="fas fa-heart"></i> Casal
                        </button>
                        <button class="view-btn" data-tipo="familia">
                            <i class="fas fa-users"></i> Fam√≠lia
                        </button>
                    </div>
                    
                    <!-- Toggle de Compara√ß√£o -->
                    <div class="comparacao-toggle">
                        <label>
                            <input type="checkbox" id="toggleComparacao">
                            <i class="fas fa-balance-scale"></i>
                            Ativar Gr√°ficos Comparativos
                        </label>
                    </div>
                    
                    <!-- Filtros Normais -->
                    <div class="filtros-row">
                        <div class="filtro-group">
                            <label class="filtro-label">M√™s</label>
                            <select id="mesGrafico" class="filtro-select">
                                <!-- Preenchido via JS -->
                            </select>
                        </div>
                        <div class="filtro-group">
                            <label class="filtro-label">Ano</label>
                            <select id="anoGrafico" class="filtro-select">
                                <!-- Preenchido via JS -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- Filtros de Compara√ß√£o (ocultos por padr√£o) -->
                    <div id="comparacaoContainer" class="comparacao-filtros">
                        <h4 style="color: var(--text-primary); margin-bottom: 16px; text-align: center;">
                            <i class="fas fa-calendar-alt"></i> Selecione o Per√≠odo para Comparar
                        </h4>
                        <div class="filtros-row">
                            <div class="filtro-group">
                                <label class="filtro-label">M√™s de Compara√ß√£o</label>
                                <select id="mesComparacao" class="filtro-select">
                                    <!-- Preenchido via JS -->
                                </select>
                            </div>
                            <div class="filtro-group">
                                <label class="filtro-label">Ano de Compara√ß√£o</label>
                                <select id="anoComparacao" class="filtro-select">
                                    <!-- Preenchido via JS -->
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√£o Gerar Gr√°ficos -->
                    <button class="btn-primary btn-large" onclick="gerarGraficos()" style="margin-top: 20px;">
                        <i class="fas fa-chart-area"></i> Gerar Gr√°ficos
                    </button>
                </div>

                <!-- CONTAINER DOS GR√ÅFICOS -->
                <div class="graficos-container">
                    <div id="graficosConteudo">
                        <!-- Gr√°ficos ser√£o renderizados aqui via JS -->
                    </div>
                </div>
            </section>

            <!-- RELAT√ìRIOS -->
            <section class="page" id="relatoriosPage">
                <div class="page-header-premium">
                    <div class="header-content">
                        <div class="header-title-group">
                            <div class="breadcrumb-premium">
                                <a href="dashboard.html">In√≠cio</a>
                                <span class="separator">‚Ä∫</span>
                                <span>Relat√≥rios</span>
                            </div>
                            <h1 class="page-title-premium"><i class="fas fa-chart-line"></i> Relat√≥rios</h1>
                            <p class="page-subtitle-premium">An√°lises detalhadas e insights sobre suas finan√ßas</p>
                        </div>
                    </div>
                </div>

                <div class="filtros-box">
                    <div class="tipo-relatorio-btns">
                        <button class="tipo-btn active" data-tipo="individual"><i class="fas fa-user"></i> Individual</button>
                        <button class="tipo-btn" data-tipo="casal"><i class="fas fa-heart"></i> Casal</button>
                        <button class="tipo-btn" data-tipo="familia"><i class="fas fa-users"></i> Fam√≠lia</button>
                    </div>

                    <div id="perfilSelectorDiv" class="perfil-selector">
                        <select id="selectPerfilRelatorio" class="form-input">
                            <option value="">Selecione o perfil</option>
                        </select>
                    </div>

                    <div class="filtros-row">
                        <select id="mesRelatorio" class="form-input">
                            <option value="">M√™s</option>
                        </select>
                        <select id="anoRelatorio" class="form-input">
                            <option value="">Ano</option>
                        </select>
                    </div>
                    <button class="btn-primary btn-large" id="btnGerarRelatorio">Gerar Relat√≥rio</button>
                </div>

                <div id="relatorioResultado" style="display:none;"></div>
            </section>

            <!-- CONFIGURA√á√ïES -->
            <section class="page" id="configuracoesPage">
                <div class="page-header-premium">
                    <div class="header-content">
                        <div class="header-title-group">
                            <div class="breadcrumb-premium">
                                <a href="dashboard.html">In√≠cio</a>
                                <span class="separator">‚Ä∫</span>
                                <span>Configura√ß√µes</span>
                            </div>
                            <h1 class="page-title-premium"><i class="fas fa-cog"></i> Configura√ß√µes</h1>
                            <p class="page-subtitle-premium">Personalize sua experi√™ncia no GranaEvo</p>
                        </div>
                        <div class="header-actions">
                        </div>
                    </div>
                </div>

                <div class="config-grid">
                    <button class="config-card" id="btnAlterarNome">
                        <div class="config-icon"><i class="fas fa-user"></i></div>
                        <div class="config-text">
                            <h3>Alterar Nome</h3>
                            <p>Mude seu nome ou apelido</p>
                        </div>
                        <span class="config-arrow">‚Üí</span>
                    </button>

                    <button class="config-card" id="btnAlterarEmail">
                        <div class="config-icon"><i class="fas fa-user-plus"></i></div>
                        <div class="config-text">
                            <h3>Convidar Usu√°rio</h3>
                            <p>Compartilhe o acesso √† sua conta com amigos e familiares</p>
                        </div>
                        <span class="config-arrow">‚Üí</span>
                    </button>

                    <button class="config-card" id="btnAlterarSenha">
                        <div class="config-icon"><i class="fas fa-lock"></i></div>
                        <div class="config-text">
                            <h3>Alterar Senha</h3>
                            <p>Defina uma nova senha</p>
                        </div>
                        <span class="config-arrow">‚Üí</span>
                    </button>

                    <button class="config-card" id="btnTrocarPerfil">
                        <div class="config-icon"><i class="fas fa-sync-alt"></i></div>
                        <div class="config-text">
                            <h3>Trocar Perfil</h3>
                            <p>Alternar entre perfis</p>
                        </div>
                        <span class="config-arrow">‚Üí</span>
                    </button>

                    <button class="config-card" id="btnComoUsar">
                        <div class="config-icon"><i class="fas fa-question-circle"></i></div>
                        <div class="config-text">
                            <h3>Como Usar</h3>
                            <p>Guia do GranaEvo</p>
                        </div>
                        <span class="config-arrow">‚Üí</span>
                    </button>

                    <button class="config-card" id="btnDownload">
                        <div class="config-icon"><i class="fas fa-question-circle"></i></div>
                        <div class="config-text">
                            <h3>Download</h3>
                            <p>Fa√ßa o download e tenha f√°cil acesso</p>
                        </div>
                        <span class="config-arrow">‚Üí</span>
                    </button>                    

                    <button class="config-card" id="btnUpgradePlano">
                        <div class="config-icon"><i class="fas fa-question-circle"></i></div>
                        <div class="config-text">
                            <h3>Upgrade de plano</h3>
                            <p>Tenha mais perfis</p>
                        </div>
                        <span class="config-arrow">‚Üí</span>
                    </button>     

                    <button class="config-card config-danger" id="btnLogout">
                        <div class="config-icon"><i class="fas fa-sign-out-alt"></i></div>
                        <div class="config-text">
                            <h3>Sair / Logout</h3>
                            <p>Encerrar sess√£o</p>
                        </div>
                        <span class="config-arrow">‚Üí</span>
                    </button>
                </div>
            </section>

        </main>
    </div>

    <!-- MODAL/POPUP -->
    <div id="modalOverlay" class="modal-overlay"></div>
    <div id="modalContainer"></div>

    <!-- Scripts do Sistema -->
    <script type="module" src="dashboard.js"></script>
    <script type="module" src="chat-assistant.js"></script>
    <script src="graficos.js"></script>
</body>
</html>